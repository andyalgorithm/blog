(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{420:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"docker基础-docker数据卷和数据管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker基础-docker数据卷和数据管理"}},[a._v("#")]),a._v(" Docker基础 - Docker数据卷和数据管理")]),a._v(" "),t("blockquote",[t("p",[a._v("Docker 容器的数据放哪里呢？ 本文带你理解如何在 Docker 内部以及容器之间管理数据。@pdai")])]),a._v(" "),t("ul",[t("li",[a._v("Docker基础 - Docker数据卷和数据管理\n"),t("ul",[t("li",[a._v("Docker 数据管理简介\n"),t("ul",[t("li",[a._v("数据卷(Data Volume)\n"),t("ul",[t("li",[t("a",{attrs:{href:"#%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("建一个数据卷")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("挂载一个主机目录作为数据卷")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BA%E6%96%87%E4%BB%B6%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("挂载一个本地主机文件作为数据卷")])])])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8data-volume-container"}},[a._v("数据卷容器(Data Volume Container)")])]),a._v(" "),t("li",[a._v("数据备份、恢复、迁移数据卷\n"),t("ul",[t("li",[t("a",{attrs:{href:"#%E5%A4%87%E4%BB%BD"}},[a._v("备份")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%81%A2%E5%A4%8D"}},[a._v("恢复")])])])])])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[a._v("参考文章")])])])])]),a._v(" "),t("h2",{attrs:{id:"docker-数据管理简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-数据管理简介"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#docker-%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%AE%80%E4%BB%8B"}},[a._v("#")]),a._v(" Docker 数据管理简介")]),a._v(" "),t("h3",{attrs:{id:"数据卷-data-volume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据卷-data-volume"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%8D%B7-data-volume"}},[a._v("#")]),a._v(" 数据卷(Data Volume)")]),a._v(" "),t("blockquote",[t("p",[a._v("数据卷的使用，类似于 Linux 下对目录或文件进行 mount")])]),a._v(" "),t("p",[a._v("数据卷(Data Volume)是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：")]),a._v(" "),t("ul",[t("li",[a._v("数据卷可以在容器之间共享和重用")]),a._v(" "),t("li",[a._v("对数据卷的修改会立马生效")]),a._v(" "),t("li",[a._v("对数据卷的更新，不会影响镜像")]),a._v(" "),t("li",[a._v("卷会一直存在，直到没有容器使用")])]),a._v(" "),t("h4",{attrs:{id:"建一个数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建一个数据卷"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("#")]),a._v(" 建一个数据卷")]),a._v(" "),t("blockquote",[t("p",[a._v("在用 docker run 命令的时候，使用 -v 标记来创建一个数据卷并挂载到容器里。在一次 run 中多次使用可以挂载多个数据卷。")])]),a._v(" "),t("p",[a._v("下面创建一个 web 容器，并加载一个数据卷到容器的 /webapp-data 目录。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d -P --name web -v /webapp-data training/webapp python app.py")]),a._v("\ne331e83e59486a131919cba8698b24eaee051a947838bb1c15c03df8b3464b97\n")])])]),t("p",[a._v("我们看下容器内部是否生成/webapp-data目录")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker exec -it web /bin/bash")]),a._v("\nroot@e331e83e5948:/opt/webapp"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd /webapp-data")]),a._v("\nroot@e331e83e5948:/webapp-data"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll")]),a._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" 01:24 ./\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" 01:24 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/\nroot@e331e83e5948:/webapp-data"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n")])])]),t("p",[a._v("*注意：也可以在 Dockerfile 中使用 VOLUME 来添加一个或者多个新的卷到由该镜像创建的任意容器。")]),a._v(" "),t("h4",{attrs:{id:"挂载一个主机目录作为数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载一个主机目录作为数据卷"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("#")]),a._v(" 挂载一个主机目录作为数据卷")]),a._v(" "),t("blockquote",[t("p",[a._v("使用 -v 标记也可以指定挂载一个本地主机的目录到容器中去。")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker rm -f web")]),a._v("\nweb\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d --name web -v /opt/webapp-data5:/opt/webapp2 training/webapp")]),a._v("\nfce27f6ea9ce9699864644a48aed6db8b772c96be36f46bee6154d2e2c9915b9\n")])])]),t("p",[a._v("我们验证下：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker exec -it web /bin/bash")]),a._v("\nroot@fce27f6ea9ce:/opt/webapp"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd ..")]),a._v("\nroot@fce27f6ea9ce:/opt"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ls")]),a._v("\nwebapp  webapp2\nroot@fce27f6ea9ce:/opt"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd webapp2")]),a._v("\nroot@fce27f6ea9ce:/opt/webapp2"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mkdir test")]),a._v("\nroot@fce27f6ea9ce:/opt/webapp2"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# exit")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd webapp-data5")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai webapp-data5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll")]),a._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(":12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])])]),t("p",[a._v("上面的命令加载主机的 /opt/webapp-data5 目录到容器的 /opt/webapp2 目录。这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。"),t("strong",[a._v("本地目录的路径必须是绝对路径，如果目录不存在 Docker 会自动为你创建它")]),a._v("。")]),a._v(" "),t("p",[a._v("*注意：Dockerfile 显然是不支持这种用法，这是因为 Dockerfile 是为了移植和分享用的, 因为不同操作系统的路径格式不一样，所以目前还不能支持。")]),a._v(" "),t("p",[a._v("我们删除容器，看主机上数据是否会被删除")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker rm -f web")]),a._v("\nweb\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd /opt/webapp-data5")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai webapp-data5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll")]),a._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(":12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n")])])]),t("p",[a._v("很明显，没有被删除")]),a._v(" "),t("h4",{attrs:{id:"挂载一个本地主机文件作为数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载一个本地主机文件作为数据卷"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BA%E6%96%87%E4%BB%B6%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("#")]),a._v(" 挂载一个本地主机文件作为数据卷")]),a._v(" "),t("blockquote",[t("p",[a._v("-v 标记也可以从主机挂载单个文件到容器中")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash")]),a._v("\nroot@79eca07938db:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll | grep .bash_history")]),a._v("\n-rw-------   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19549")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(":28 .bash_history\nroot@79eca07938db:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# exit")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n")])])]),t("p",[a._v("这样就可以记录在容器输入过的命令了。")]),a._v(" "),t("p",[a._v("*注意：如果直接挂载一个文件，很多文件编辑工具，包括 "),t("code",[a._v("vi")]),a._v(" 或者 "),t("code",[a._v("sed --in-place")]),a._v("，可能会造成文件 inode 的改变，从 Docker 1.1 .0起，这会导致报错误信息。所以最简单的办法就直接挂载文件的父目录。")]),a._v(" "),t("h3",{attrs:{id:"数据卷容器-data-volume-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据卷容器-data-volume-container"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8-data-volume-container"}},[a._v("#")]),a._v(" 数据卷容器(Data Volume Container)")]),a._v(" "),t("blockquote",[t("p",[a._v("上面讲述的是主机和容器之间共享数据，那么如何你有一些持续更新的数据需要在容器之间共享，最好的方法就是创建数据卷容器。")])]),a._v(" "),t("p",[a._v("数据卷容器，其实就是一个正常的容器，专门用来提供数据卷供其它容器挂载的。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d -v /dbdata --name dbdata training/postgres")]),a._v("\n70966085a85b05dd741a44a96725e2e44f146cc404b1b4e3aa3e519cd546c6b4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d --volumes-from dbdata --name db1 training/postgres")]),a._v("\n4c92240096d919724b233e1a5cfca94b5ceb0505e43262a7121cb83cfd8542f6\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d --volumes-from dbdata --name db2 training/postgres")]),a._v("\n25246ebfae2f8437316b10d7eac3b34c1bd1522f50ba81651aec198bc79415a2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker ps -a")]),a._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES\n70966085a85b        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("46")]),a._v(" seconds ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("45")]),a._v(" seconds       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            dbdata\n25246ebfae2f        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   About a minute ago   Up About a minute   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            db2\n4c92240096d9        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes ago        Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            db1\n")])])]),t("p",[a._v("-volumes-from 可以多次使用来 mount 多个conatainer里的多个volumes。")]),a._v(" "),t("p",[a._v("这个操作是链式的， 我们在db1 中通过 --volumes-from mount进来的 volume可以继续被其他container使用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d --name db3 --volumes-from db1 training/postgres")]),a._v("\n44d0719377e86e3080b26d22adcb6055de93033dc9509ca2ecd8be2c93dc33b5\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker ps")]),a._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n44d0719377e8        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" seconds ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" seconds        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            db3\n70966085a85b        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" minutes ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            dbdata\n25246ebfae2f        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" minutes ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            db2\n4c92240096d9        training/postgres   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"su postgres -c \'/us…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" minutes ago       Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" minutes        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("/tcp            db1\n")])])]),t("p",[t("strong",[a._v("使用 --volumes-from 参数所挂载数据卷的容器自己并不需要保持在运行状态")]),a._v("。")]),a._v(" "),t("p",[t("strong",[a._v("如果删除了挂载的容器（包括 dbdata、db1 和 db2），数据卷并不会被自动删除。如果要删除一个数据卷，必须在删除最后一个还挂载着它的容器时使用 "),t("code",[a._v("docker rm -v")]),a._v(" 命令来指定同时删除关联的容器。 这可以让用户在容器之间升级和移动数据卷")]),a._v("。")]),a._v(" "),t("h3",{attrs:{id:"数据备份、恢复、迁移数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据备份、恢复、迁移数据卷"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E3%80%81%E6%81%A2%E5%A4%8D%E3%80%81%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E5%8D%B7"}},[a._v("#")]),a._v(" 数据备份、恢复、迁移数据卷")]),a._v(" "),t("p",[a._v("可以利用数据卷对其中的数据进行进行备份、恢复和迁移。")]),a._v(" "),t("h4",{attrs:{id:"备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E5%A4%87%E4%BB%BD"}},[a._v("#")]),a._v(" 备份")]),a._v(" "),t("p",[a._v("首先使用 --volumes-from 标记来创建一个加载 dbdata 容器卷的容器，并从本地主机挂载当前到容器的 /backup 目录。命令如下：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata")]),a._v("\ntar: Removing leading `/' from member names\n/dbdata/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll | grep backup.tar")]),a._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10240")]),a._v(" Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v(":39 backup.tar\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n")])])]),t("p",[a._v("容器启动后，使用了 tar 命令来将 dbdata 卷备份为本地的 /backup/backup.tar。")]),a._v(" "),t("h4",{attrs:{id:"恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恢复"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E6%81%A2%E5%A4%8D"}},[a._v("#")]),a._v(" 恢复")]),a._v(" "),t("p",[a._v("如果要恢复数据到一个容器")]),a._v(" "),t("p",[a._v("首先创建一个带有数据卷的容器 dbdata2")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -v /dbdata --name dbdata2 ubuntu /bin/bash")]),a._v("\n")])])]),t("p",[a._v("然后创建另一个容器，挂载 dbdata2 的容器，并使用 untar 解压备份文件到挂载的容器卷中。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@pdai ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run --volumes-from dbdata2 -v $(pwd):/backup ubuntu tar xvf /backup/backup.tar")]),a._v("\ndbdata/\n")])])]),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),t("ul",[t("li",[a._v("https://docs.docker.com/storage/")])]),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("著作权归@pdai所有 原文链接：https://pdai.tech/md/devops/docker/docker-06-data.html")])])}),[],!1,null,null,null);t.default=n.exports}}]);